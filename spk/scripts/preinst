#!/bin/sh
# preinst - Pre-installation check for SyrvisCore
# Runs as package user (syrvis-bot), not root - can only do basic checks

# Check if Docker package is installed
if ! synopkg status Docker >/dev/null 2>&1; then
    echo "ERROR: Docker package not installed. Install Docker from Package Center first."
    exit 1
fi

# Check if Docker is running
if ! synopkg is_onoff Docker >/dev/null 2>&1 || [ "$(synopkg is_onoff Docker)" != "on" ]; then
    echo "ERROR: Docker not running. Start Docker from Package Center first."
    exit 1
fi

# Check if docker command is available
if ! command -v docker >/dev/null 2>&1; then
    echo "ERROR: Docker command not found. Check Docker installation."
    exit 1
fi

# Check if python3 is available
if ! command -v python3 >/dev/null 2>&1; then
    echo "ERROR: Python 3 not found. Your DSM version may not be supported."
    exit 1
fi

# Check Docker daemon is accessible
if ! docker ps >/dev/null 2>&1; then
    echo "ERROR: Cannot access Docker daemon. This may be a permissions issue."
    exit 1
fi

# Basic validation passed
exit 0
